
(in-package #:j-plankton.cursor)


;;=========================================================================

;;;;
;;;; Craete a new method based on the properties of
;;;; a cursor given to it
(defmacro define-props-method (name
			       (cursor-var props)
			       lambda-list
			       &body body)
  (let* ((props-class
	  (if (null props)
	      't
	      (cursor-properties-class props)))
	 (modified-lambda-list
	  (cons `(props ,props-class)
		lambda-list))
	 (impl-method-symbol
	  (jpu:intern+ *package* name :/props-impl))
	 (impl-fowarding-arguments
	  (handler-bind ((warning #'muffle-warning))
	    (jp.doc-ll:foward-arguments-from-documented-lambda-list
	     lambda-list :error-on-missing-doc nil)))
	 (interface-method-def
	  `(defmethod ,name ,lambda-list
	     (,impl-method-symbol
	      (cursor/properties-class-object ,cursor-var)
	      ,@impl-fowarding-arguments)))
	 (impl-method-def
	  `(defmethod ,impl-method-symbol ,modified-lambda-list
	     ,@body)))
    `(progn
       ,interface-method-def
       ,impl-method-def)))

;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
;;=========================================================================
